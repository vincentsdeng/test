(function(c){function v(b,a){var e=c(this);$p=c("#tsd_select_time");this.id||(this.id="tsd_btn_"+btnNumber++);e.removeData().data("settings",b);e.unbind("click.selectfortime");e.bind("click.selectfortime",w);b.pid&&c("#"+b.pid).data("childID",this.id);$p&&0===$p.length&&(c.each(x,function(d,a){k(ALLHTML,a,l[d])}),c.each(y,function(d,a){k(CBHTML,a,l[d])}),c.each(z,function(d,a){k(s,a,l[d])}),$p=c("<div id='tsd_select_time' class='tsd_frame'></div>").appendTo("body").hide(),A&&(ALLHTML[0]="<iframe frameborder='0' scrolling='no' height='100%' width='100%' scr='javascript:false;' style='position:absolute;left:0px;top:0px;background-color:transparent;z-index:-1' />"),
$p.delegate(":button","click.tsd",function(d){var a=this.getAttribute("tsd_bt");"2"==a?B.call(this,d):(d=t([0,-1][a]),c("#tsd_time").val(d),m(d))}),$p.delegate("#tsd_time","keyup.tsd",function(d){d=this.value;nowTime!=d&&(EDATE.test(d)?m(d):param.notime&&""==c.trim(d)&&m(d))}),$p.delegate("#tsd_time","focus.tsd",function(d){d=this.value;param.notime&&(""==c.trim(d)&&nowTime!=d)&&m(d)}),$p.delegate("#tsd_ord_time,#tsd_ord_name","click.tsd",function(d){d=this.value;showIdx!=d&&($p.children("div.tsd_body").html(showSelectHTML[d].join("")),
showIdx=d)}),$p.delegate("div.tsd_close","click.tsd",function(d){r();q()}),$p.delegate("#tsd_all","click.tsd",function(d){c("#tsd_invert").removeAttr("checked");this.checked?(c("#tsd_dall").removeAttr("checked"),$p.children(".tsd_body").find(":checkbox").attr("checked","checked").each(function(){showSelectHTML[0][dataIdx[this.value]][f.slctchedIdx]=h})):(c("#tsd_dall").attr("checked","checked"),$p.children(".tsd_body").find(":checkbox").removeAttr("checked").each(function(){delete showSelectHTML[0][dataIdx[this.value]][f.slctchedIdx]}))}),
$p.delegate("#tsd_dall","click.tsd",function(d){c("#tsd_invert").removeAttr("checked");this.checked?(c("#tsd_all").removeAttr("checked"),$p.children(".tsd_body").find(":checkbox").removeAttr("checked").each(function(){delete showSelectHTML[0][dataIdx[this.value]][f.slctchedIdx]})):(c("#tsd_all").attr("checked","checked"),$p.children(".tsd_body").find(":checkbox").attr("checked","checked").each(function(){showSelectHTML[0][dataIdx[this.value]][f.slctchedIdx]=h}))}),$p.delegate("#tsd_invert","click.tsd",
function(d){d=$p.children(".tsd_body");var a=d.find(":checkbox:checked");d.find(":checkbox:not(:checked)").attr("checked","checked").each(function(){showSelectHTML[0][dataIdx[this.value]][f.slctchedIdx]=h});a.removeAttr("checked").each(function(){delete showSelectHTML[0][dataIdx[this.value]][f.slctchedIdx]});0<c("#tsd_dall:checked").removeAttr("checked").length?c("#tsd_all").attr("checked","checked"):0<c("#tsd_all:checked").removeAttr("checked").length&&c("#tsd_dall").attr("checked","checked")}),
$p.delegate("div.tsd_body :checkbox","change.tsd",function(d){this.checked?showSelectHTML[0][dataIdx[this.value]][f.slctchedIdx]=h:delete showSelectHTML[0][dataIdx[this.value]][f.slctchedIdx];c("#tsd_invert").removeAttr("checked");var a=$p.children(".tsd_body");d=a.find(":checkbox").length;a=a.find(":checked").length;0<d&&d===a?(c("#tsd_all").attr("checked","checked"),c("#tsd_dall").removeAttr("checked")):d>a&&(c("#tsd_all").removeAttr("checked"),0<d&&0==a?c("#tsd_dall").attr("checked","checked"):
c("#tsd_dall").removeAttr("checked"))}),$p.delegate("div.tsd_body :radio","change.tsd",function(a){a=this.value;radioID!=a&&(radioID&&delete showSelectHTML[0][dataIdx[radioID]][f.slctchedIdx],showSelectHTML[0][dataIdx[a]][f.slctchedIdx]=h,radioID=a)}),c(document).bind("click.selectfortime",function(a){a=c(a.target);!a.is("#tsd_select_time")&&0==a.parents("#tsd_select_time").length&&(r(),q())}).bind("keydown.selectfortime",function(a){var b=String.fromCharCode(a.keyCode);if(/^[a-zA-Z]$/.test(b)&&c("#tsd_select_time").is(":visible")){if(b=
b.toUpperCase(),c(document.activeElement).filter("input").blur(),a=$p.find("div[initial='"+b+"'].selected"),0<a.length&&(a=a.nextAll("div[initial='"+b+"']:first")),0==a.length&&(a=$p.find("div[initial='"+b+"']:first")),0<a.length){$p.find("div.selected").removeClass("selected");var b=$p.find("div.tsd_body"),e=a.addClass("selected").position().top;(0>e||e>b.height()-a.height())&&b.scrollTop(b.scrollTop()+e)}}else if(c("#tsd_select_time").is(":visible"))return b=a.keyCode,13===b?$p.find(":button[tsd_bt=2]").click():
32===b?$p.find(".selected :radio,.selected :checkbox").focus().click():/^(38|40)$/.test(b)&&(a=$p.find("div.selected").removeClass("selected"),38===b?(0<a.length&&(a=a.prev()),0==a.length&&(a=$p.find("div.tsd_name:last"))):(0<a.length&&(a=a.next()),0==a.length&&(a=$p.find("div.tsd_name:first"))),0<a.length&&(b=$p.find("div.tsd_body"),e=a.addClass("selected").position().top,(0>e||e>b.height()-a.height())&&b.scrollTop(b.scrollTop()+e))),!1}),$p.delegate("div.tsd_body .tsd_name","mousemove.tsd",function(a){c(document.activeElement).filter("input").blur();
a=c(this);a.siblings(".selected").removeClass("selected");a.addClass("selected")}),$p.delegate("div.tsd_body .tsd_name","mouseout.tsd",function(a){c(this).removeClass("selected")}),$p.delegate("div.tsd_body .err a","click.tsd",function(a){m(c("#tsd_time").val());return!1}))}function B(b){b=c("#"+nowBtnID);var a=b.data("ids")||"",e=b.data("names")||"";delete showHTML[f.ordCHIdx[1-showIdx]];showHTML[f.ordCHIdx[showIdx]]=h;showHTML[f.selectIdx]=showSelectHTML[showIdx];if(param.radio){var d=$p.find("div.tsd_body :checked").val();
d&&a!=d&&(a=d,e=dataIdx["d"+a][1])}else a=$p.find("div.tsd_body :checked").map(function(){return this.value}).get(),e=c.map(a,function(a){return dataIdx["d"+a][1]}),0<c("#tsd_all:checked").length?showCbHTML[f.chAllIdx]=h:delete showCbHTML[f.chAllIdx],0<c("#tsd_dall:checked").length?showCbHTML[f.chDallIdx]=h:delete showCbHTML[f.chDallIdx];b.data("ids",a);b.data("names",e);b.data("dataIdx",dataIdx);b.data("showHTML",showHTML);b.data("showCbHTML",showCbHTML);b.data("showSelectHTML",showSelectHTML);b.data("oldTime",
nowTime);b.data("showIdx",showIdx);(d=b.data("childID"))&&c("#"+d).removeData("oldTime");param.callback.call(b,a,e);q()}function m(b){if(nowTime!=b){$p.children("div.tsd_body").html(LOADINGHTML);var a=param.url,e=u;a&&(c.ajax({url:a,context:this,data:C(b),type:"POST",cache:!1,dataType:"json",success:D,error:e}).newTime=b)}}function C(b){var a="";if(param.pid){var e={};e[param.ppn]=c("#"+param.pid).data("ids");e[param.ppn]&&(a=a+"&"+c.param(e,!0))}param.op&&(a=a+"&"+("string"===typeof param.op?param.op:
c.param(param.op,!0)));return param.tpn+"="+b+a}function k(b,a,c){if("number"===typeof a)b[a]=c;else for(var d=a.length;d--;)b[a[d]]=c}function E(b,a){return b[2]>a[2]?1:-1}function D(b,a,e){a="";if(0==b.returncode){dataIdx={};if(b.data&&0<b.data.length){var d=param.radio?SELECTHTML[1]:SELECTHTML[0];showSelectHTML=[[].cloneForStr(),[].cloneForStr()];a=0;for(var g=b.data,h=g.length;a<h;a++)showSelectHTML[0][a]=d.cloneForStr(),k(showSelectHTML[0][a],f.slctIdIdx,a),g[a][3]?("string"==typeof g[a][3]&&
g[a][3].toUpperCase(),k(showSelectHTML[0][a],p[0],g[a][0]),k(showSelectHTML[0][a],p[1],g[a][1]+"' initial='"+g[a][3]),k(showSelectHTML[0][a],p[2],g[a][3]+" "+g[a][1])):(k(showSelectHTML[0][a],p[0],g[a][0]),k(showSelectHTML[0][a],p[1],g[a][1]),k(showSelectHTML[0][a],p[2],g[a][1])),dataIdx["d"+g[a][0]]=g[a],dataIdx[""+g[a][0]]=a;param.radio||(c("#tsd_invert").removeAttr("checked"),c("#tsd_all").removeAttr("checked"),c("#tsd_dall").attr("checked","checked"));b=b.data.sort(E);a=0;for(h=b.length;a<h;a++)showSelectHTML[1][a]=
showSelectHTML[0][dataIdx[g[a][0]]];a=showSelectHTML[showIdx].join("")}else a="<div class='err'>\u5f53\u524d\u65e5\u671f\u6ca1\u6709\u76f8\u5173\u7684\u9009\u9879\uff0c\u8bf7\u9009\u62e9\u5176\u5b83\u65e5\u671f\u3002</div>";$p.children("div.tsd_body").html(a);nowTime=e.newTime}else u.call(this,null,b.returncode,b.errmsg)}function u(b,a,c){"string"==typeof c?$p.children("div.tsd_body").html("<div class='err'>"+c+"\uff0c\u8bf7<a href='###'>\u91cd\u8bd5</a></div>"):$p.children("div.tsd_body").html("<div class='err'>\u8bf7\u6c42\u9009\u9879\u51fa\u9519\uff0c\u8bf7<a href='###'>\u91cd\u8bd5</a></div>")}
function w(b){nowBtnID!=this.id&&(nowBtnID&&(r(),q()),nowBtnID=this.id,F.call(this,b));return!1}function r(){var b=c("#"+nowBtnID),a=b.data("showSelectHTML"),e=b.data("ids")||"",b=b.data("dataIdx");if(a){for(var d=a[0].length;d--;)delete a[0][d][f.slctchedIdx];if(param.radio)e&&(a[0][b[e]][f.slctchedIdx]=h);else for(d=e.length;d--;)a[0][b[e[d]]][f.slctchedIdx]=h}}function q(){showCbHTML=showHTML=nowTime=nowBtnID=null;dataIdx={};param=null;showSelectHTML=[[].cloneForStr(),[].cloneForStr()];$p.hide().empty()}
function F(b){b=c("#tsd_select_time");var a=c(this),e=a.offset();param=a.data("settings");nowTime=a.data("oldTime");if("string"===typeof nowTime)dataIdx=a.data("dataIdx"),showHTML=a.data("showHTML"),c.isArray(showHTML[f.timeIdx])?showHTML[f.timeIdx][f.timeval]=nowTime:showHTML[f.timeIdx]=""===nowTime?l.noTime:nowTime,showSelectHTML=a.data("showSelectHTML"),showCbHTML=a.data("showCbHTML"),showIdx=a.data("showIdx"),param.radio&&(radioID=a.data("ids"));else{showHTML=ALLHTML.cloneForStr();showHTML[f.titIdx]=
param.tn;param.radio?showHTML[f.radioIdx]=l.radio:(showCbHTML=CBHTML.cloneForStr(),showHTML[f.cbIdx]=showCbHTML);var d=null,g="";param.pid&&(d=c("#"+param.pid).data("oldTime"),g=c("#"+param.pid).data("ids"));!g||0==g.length?(d=t(0),showHTML[f.timeIdx]=s.cloneForStr(),showHTML[f.timeIdx][f.timeval]=d):showHTML[f.timeIdx]=""===d?l.noTime:d;m.call(this,d)}b.html(showHTML.join(""));b.css({"z-index":c.sgfmdialog?c.sgfmdialog("get_max_zindex"):G(),top:function(){return e.top+a.outerHeight()},left:function(){var a=
c("body"),b=e.left,a=a.scrollLeft()+a.width();return a>=e.left+272?b:0<a-272?a-272:0}}).show()}function t(b){var a=new Date;a.setUTCDate(a.getUTCDate()+(b||0));a.setUTCHours(a.getUTCHours()-4);b=a.getUTCFullYear();var c=H[a.getUTCMonth()],a=I[a.getUTCDate()];return b+"-"+c+"-"+a}function G(){1>max_zindex&&(c("div").each(function(){var b=c(this).css("z-index");isNaN(b)||(b=parseInt(b),1E7>b&&(max_zindex=Math.max(b,max_zindex)))}),1>max_zindex&&(max_zindex=9999));return max_zindex}function J(b){b=b.cal.getNewDateStr();
nowTime!=b&&m(b)}Array.prototype.cloneForStr||(Array.prototype.cloneForStr=function(){var b=this.slice(0);b.toString=function(){return this.join("")};return b});var A=/msie 6\.0/i.test(navigator.userAgent),n,H="01 02 03 04 05 06 07 08 09 10 11 12".split(" "),I="00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31".split(" "),h=" checked='checked'",l={titName:"\u8054\u8d5b\u9009\u62e9",timeTit:"\u65f6\u95f4\uff1a",today:"\u4eca\u5929",yesterday:"\u6628\u5929",
ordTime:"\u6309\u5f00\u8d5b\u65f6\u95f4\u6392\u5e8f",ordName:"\u6309\u540d\u79f0\u6392\u5e8f",checkAll:"\u5168\u9009",uncheck:"\u5168\u4e0d\u9009",invert:"\u53cd\u9009",confirm:"\u786e\u5b9a",radio:"(\u5355\u9009)",noTime:"\u4e0d\u9009\u62e9\u65f6\u95f4",dir:""},x={timeTit:5,ordTime:11,ordName:15,confirm:[21,22,24]},z={today:1,yesterday:3,dir:7},y={checkAll:3,uncheck:7,invert:11},f={titIdx:2,radioIdx:3,timeval:5,timeIdx:7,ordCHIdx:[9,13],selectIdx:17,cbIdx:19,chAllIdx:1,chDallIdx:5,slctIdIdx:[3,5],
slctchedIdx:9},p=[7,1,11],s=["<label><input type='button' tsd_bt='0' value='",,"' class='tsd_bt' /></label> <label><input type='button' tsd_bt='1' value='",,"' class='tsd_bt' /></label> <label><input id='tsd_time' type='text' maxlength='10' value='",,"' style=' width:72px' onclick='WdatePicker({onpicked:$.selectfortime(\"my97ChangeTime\")})' /> <img onclick='WdatePicker({el:\"tsd_time\",onpicked:$.selectfortime(\"my97ChangeTime\")})' src='",,"../images/datePicker.gif","' alt='D' width='16' height='22' align='absmiddle'></label>"];
ALLHTML=[,"<h4 class='tit'>",,,"<div class='tsd_close'>&nbsp;</div></h4><div class='tsd_head'><label for='tsd_time' style='font-weight:bold'>",,"</label>",,"<br /><label for='tsd_ord_time' class='tsd_order'><input type='radio' name='tsd_order' id='tsd_ord_time' value='0'"," checked='checked'"," />",,"</label>&nbsp;<label for='tsd_ord_name' class='tsd_order'><input type='radio' name='tsd_order' id='tsd_ord_name' value='1'",,"/>",,"</label></div><div class='tsd_body'>",,"</div><div class='tsd_foot'>",
," <label style='color:#fff'>",,,"</label><span><input type='button' tsd_bt='2' value='",,"' class='tsd_bt' /></span></div>"];CBHTML=["<label><input id='tsd_all' type='checkbox'",," />",,"</label> <label><input id='tsd_dall' type='checkbox'",," />",,"</label> <label><input id='tsd_invert' type='checkbox'",," />",,"</label>"];SELECTHTML=[["<div title='",,"' class='tsd_name'><label for='tsd_",,"'><input type='checkbox' id='tsd_",,"' name='tsd' value='",,"'",," />",,"</label></div>"],["<div title='",
,"' class='tsd_name'><label for='tsd_",,"'><input type='radio' id='tsd_",,"' name='tsd' value='",,"'",," />",,"</label></div>"]];LOADINGHTML="<div class='loading'></div>";EDATE=/^(?:(?!0000)[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12][0-9]|3[01]))$/;showHTML=showCbHTML=null;showSelectHTML=[[].cloneForStr(),[].cloneForStr()];max_zindex=showIdx=0;nowBtnID=nowTime=null;btnNumber=11;$p=param=radioID=null;dataIdx={};_default={url:!1,tn:"\u8054\u8d5b\u9009\u62e9",tpn:"time",ppn:"parent",pid:"",rel:"",radio:!1,
notime:!1,op:"",callback:c.noop};c(document).ready(function(){window.sgfm&&window.sgfm.selectfortimeInfo&&c.extend(l,sgfm.selectfortimeInfo)});c.fn.selectfortime=function(b){var a="string"==typeof b,e=Array.prototype.slice.call(arguments,1),d=this;if(a&&"_"==b.substring(0,1))return d;if(a){var f;this.each(function(){n&&c.isFunction(n[b])&&(f=n[b].apply(this,e));f&&(d=f)})}else b=c.extend({},_default,b),c.isFunction(e[0])||(e[0]=c.noop),this.each(function(){v.call(this,b,e[0])});return d};c.selectfortime=
function(b){var a=Array.prototype.slice.call(arguments,1);if(n&&c.isFunction(n[b]))return n[b](a)};c.selectfortime.version=c.selectfortime.v="1.0.016_1.8";n=c.selectfortime._fn={my97ChangeTime:function(){return J},version:function(){return"1.0.016_1.8"},v:function(){return"1.0.016_1.8"}}})(jQuery);
